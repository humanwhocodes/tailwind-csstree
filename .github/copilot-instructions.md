# Tailwind CSSTree

Tailwind CSSTree is a TypeScript/JavaScript library that provides CSSTree syntax extensions for parsing Tailwind CSS custom syntax (both v3 and v4). It exports `tailwind3` and `tailwind4` objects that extend CSSTree's parsing capabilities to handle Tailwind-specific directives like `@apply`, `@config`, `@plugin`, `@theme`, etc.

**ALWAYS reference these instructions first and fallback to search or bash commands only when you encounter unexpected information that does not match the info here.**

## Working Effectively

### Bootstrap and Build

Run these commands in sequence to set up the repository:

- `npm install` -- installs dependencies in ~15 seconds
- `npm run build` -- compiles TypeScript to JavaScript in dist/ directory in ~1.2 seconds

### Testing

- `npm test` -- runs full test suite (build + unit tests + type checking) in ~4 seconds
- `npm run test:unit` -- runs only Mocha unit tests in ~1 second
- `npm run test:attw` -- runs "Are The Types Wrong" type checking in ~1.5 seconds
- `npm run test:jsr` -- tests JSR publishing (FAILS due to network restrictions - this is expected)

### Code Quality

- `npm run lint` -- runs ESLint on src/ and tests/ directories in ~0.7 seconds
- `npm run fmt` -- runs Prettier formatting in ~0.9 seconds

**ALWAYS run `npm run lint` and `npm run fmt` before committing changes or the CI (.github/workflows/nodejs-test.yml and .github/workflows/bun-test.yml) will fail.**

## Validation

### Manual Testing Scenarios

After making changes, ALWAYS validate functionality by running these scenarios:

1. **Basic Tailwind 3 parsing test:**

    ```javascript
    import { fork } from "@eslint/css-tree";
    import { tailwind3 } from "./dist/index.js";

    const tw3 = fork(tailwind3);
    const result = tw3.parse(
    	"@config 'tailwind.config.js'; @apply bg-blue-500 hover:bg-blue-700;",
    );
    console.log("✓ Tailwind 3 parsing successful");
    ```

2. **Basic Tailwind 4 parsing test:**

    ```javascript
    import { fork } from "@eslint/css-tree";
    import { tailwind4 } from "./dist/index.js";

    const tw4 = fork(tailwind4);
    const result = tw4.parse(
    	"@plugin 'tailwindcss/typography'; @theme { --primary: #ff0000; }",
    );
    console.log("✓ Tailwind 4 parsing successful");
    ```

3. **Theme function parsing:**
    ```javascript
    const themeResult = tw4.parse(
    	".test { color: theme(colors.red.500); margin: --spacing(4); }",
    );
    console.log("✓ Theme function parsing successful");
    ```

### Comprehensive Testing

- Build and run `npm test` after every significant change
- Verify that existing tests still pass - DO NOT modify tests to make them pass unless the change is intentionally breaking test expectations
- The test suite covers both Tailwind 3 and 4 syntax extensively with fixtures in `tests/fixtures/`

## Repository Structure

### Key Files and Directories

```
/home/runner/work/tailwind-csstree/tailwind-csstree/
├── src/
│   ├── index.js                 # Main entry point, exports tailwind3 and tailwind4
│   ├── tailwind3.js             # Tailwind v3 syntax definitions
│   ├── tailwind4.js             # Tailwind v4 syntax definitions
│   ├── atrule/                  # At-rule definitions (@apply, @import, etc.)
│   ├── node/                    # Node type definitions (theme keys, classes)
│   ├── scope/                   # Scope definitions for theme functions
│   └── types/                   # Type definitions for theme-related syntax
├── tests/
│   ├── tailwind3.test.js        # Tailwind 3 syntax tests
│   ├── tailwind4.test.js        # Tailwind 4 syntax tests
│   ├── fixtures/                # Test CSS files with Tailwind syntax
│   └── helpers/                 # Test helper functions
├── dist/                        # Build output (generated by TypeScript)
├── .github/workflows/           # CI/CD workflows (Node.js and Bun)
├── package.json                 # Dependencies and npm scripts
├── tsconfig.json               # TypeScript configuration
└── eslint.config.js            # ESLint configuration with CSS plugin integration
```

### Build System

- Uses TypeScript compiler (`tsc`) to compile JavaScript with type checking
- Input: `src/index.js` and related files
- Output: `dist/` directory with JavaScript and TypeScript declaration files
- No bundling required - simple file-to-file compilation

## Common Tasks

### Adding New Tailwind Syntax Support

1. Add syntax definitions to appropriate files in `src/atrule/`, `src/node/`, `src/scope/`, or `src/types/`
2. Update `src/tailwind3.js` or `src/tailwind4.js` to include new definitions
3. Add corresponding tests in `tests/tailwind3.test.js` or `tests/tailwind4.test.js`
4. Add test fixtures in `tests/fixtures/` if needed
5. Run `npm run build && npm test` to verify changes

### Debugging Parsing Issues

1. Check existing test fixtures in `tests/fixtures/tailwind3.css` and `tests/fixtures/tailwind4.css`
2. Use the manual testing approach above to isolate specific parsing problems
3. Run `npm run lint` to catch any ESLint issues with the syntax definitions
4. The repository includes ESLint configuration that uses this library itself for CSS linting

### Working with CSSTree Integration

- This library is designed to be used with `@eslint/css-tree` via the `fork()` function
- The syntax extensions follow CSSTree's syntax definition format
- Test integration by importing and using the syntax with ESLint CSS plugin (see `eslint.config.js` for examples)

## CI Requirements

The CI workflows (.github/workflows/nodejs-test.yml and .github/workflows/bun-test.yml) run:

- **Linting**: Must pass `npm run lint`
- **Building**: Must pass `npm run build`
- **Testing**: Must pass `npm test`
- **Cross-platform**: Tests on Windows, macOS, and Ubuntu
- **Multi-version**: Tests on Node.js 18.x, 20.x, 22.x
- **Bun compatibility**: Also runs tests with Bun runtime

## Known Limitations

- `npm run test:jsr` fails due to network restrictions (cannot reach dl.deno.land) - this is expected in CI environments
- JSR publishing requires network access to Deno registry
- Some ESLint CSS plugin rules may not work perfectly with all Tailwind syntax (actively being worked on)

## Dependencies Overview

- **Runtime**: `@eslint/css-tree` (peer dependency for syntax extensions)
- **Dev Dependencies**: TypeScript, ESLint, Prettier, Mocha for testing, @arethetypeswrong/cli for type checking
- **Node.js Version**: Requires Node.js ≥18.18 (specified in package.json engines)

## Quick Command Reference

```bash
npm install           # ~15 seconds - install dependencies
npm run build        # ~1.2 seconds - compile TypeScript
npm run lint         # ~0.7 seconds - run ESLint
npm run fmt          # ~0.9 seconds - run Prettier
npm test             # ~4 seconds - full test suite
npm run test:unit    # ~1 second - unit tests only
```

All commands are fast and do not require special timeout considerations.
